/*! gratify 2.0.0 2023-03-25 10:03 AM */
var __gfy_version__="2.0.0";function assert(t,e){if("object"==typeof e&&e.indexOf){if(-1===e.indexOf(typeof t))throw new TypeError("Bad parameter of type "+typeof t+", expecting "+e.join(", "))}else if(typeof t!==String(e))throw new TypeError("Bad parameter of type "+typeof t+", expecting "+e)}function GratifyMain(){var f=this;this.ready=!1,this.config={},this.error_callback=null,this.version=0,this.error_exists=!1,this.last_error="",this.endpoint="",this.system_endpoint="",this.api_endpoint="",this.auth_endpoint="",this.img_path="",this.user_info={},this.components={},this.debug_css=!1,this.debug_active=!1,this.init=function(t){if(f.ready)return!0;try{assert(t,["object","undefined"])}catch(t){return f.error(t.message,"Main::init")}t&&(f.config=t);t=$('script[src*="gratify-"]');if(0==t.length)return f.error("could not locate gratify script tag","Main::init");f.app=new GratifyApp;var t=t.attr("src"),e=t.match(/^(https?:\/\/[^\/]+\/)([a-z\d\-]*\/)?/i),e=(f.endpoint=e?e[1]+e[2]:String(f.app.base||""),f.endpoint=f.endpoint.replace(/\/$/,""),f.img_path=f.endpoint+"/public/img",f.system_endpoint=f.endpoint+"/sys",f.api_endpoint=f.endpoint+"/api",f.auth_endpoint=f.api_endpoint+"/auth/oauth",t.match(/\?[^\?]+$/i));if(e)try{var r=e[0].substring(1).split("&"),i={};if(r.length){for(var a in r){var n=r[a],o=n.split("=");if(2!=o.length)throw{message:"no value for key '"+n[0]+"'"};var s=o[0],c=o[1];i[s]=c}Object.assign(f.config,i)}}catch(t){gratify.error("found invalid inclusion arguments: "+t.message,"Main::init")}t=["cookie","header"];if(-1===$.inArray(f.config.auth_proto,t))return f.error("bad config: unknown auth_proto '"+f.config.auth_proto+"'; valid types are "+t.join(", "),"Main::init");f.dictionary=new GratifyDictionary,f.thread=new GratifyThread,f.app.setVersionTag(btoa(f.version).replace(/[^a-z\d]/i,"")),f.app.sense(),f.web=new GratifyWeb,f.auth=new GratifyAuth,f.datasource=new GratifyDatasource,f.cmanager=new GratifyCManager,f.scanner=new GratifyScanner,f.router=new GratifyRouter,f.ready=!0},this.q=function(t){return $?t?$(t):$:f.error("bad dom framework (missing jquery)","Main::q")},this.info=function(){console.log("version: "+f.version),console.log("jquery version: "+jQuery().jquery),console.log("dictionary size: "+JSON.stringify(f.dictionary.definitions).length),console.log("component count: "+Object.keys(f.cmanager.components).length),console.log("subscriber count: "+Object.keys(f.datasource.subscribers).length),console.log("thread count: "+Object.keys(f.thread.intervals).length),console.log("thread density: "+function(){var t,e=0;for(t in f.thread.intervals)e+=1/f.thread.intervals[t].frequency;return e}().toFixed(3)+" / sec")},this.setErrorCallback=function(t){try{assert(t,"function")}catch(t){return f.error(t.message,"Main::setErrorCallback")}f.error_callback=t},this.error=function(t,e){return e="string"!=typeof e?"":e,t="object"==typeof t?JSON.stringify(t):String(t),f.last_error=t,f.error_exists=!0,console.error("Gratify Error"+(e?" ("+e+")":"")+": "+t),f.error_callback&&f.error_callback(t,e),!1},this.say=function(t){Number(f.config.loud)&&console.log('Gratify says, "'+("object"==typeof t?JSON.stringify(t):String(t))+'"')},this.request=function(t,e,r,i){return f.web.request(t,e,r,i)},this.def=function(t,e){return void 0===e?f.dictionary.lookup(t):f.dictionary.define(t,e)},this.goto=function(t,e,r){f.router.goto(t,e,r)},this.plugin=function(t,e,r,i){try{assert(t,["string","object"]),assert(e,"string"),assert(r,["undefined","object"]),assert(i,["undefined","string"])}catch(t){return f.error(t.message,"Main::plugin")}i=String(i),r=JSON.stringify(r||{}).replaceAll('"',"&quot;");var a="string"==typeof t?$(t):t,n='<div gratify-plugin="'+e+"("+r+')"></div>';if(null===a)return n;if(!a.length)return f.error("plugin target '"+t+"' does not exist");switch(i.toLowerCase()){case"append":a.append(n);break;case"reload":var o=a.attr("class");($div=$(n)).addClass(o),a.replaceWith($div);break;default:a.html(n)}return!0},this.spawn=function(t,e,r){try{assert(t,"object"),assert(e,["undefined","object"]),assert(r,["undefined","boolean"])}catch(t){return f.error(t.message,"Main::spawn")}return f.cmanager.spawn(t,e,r)},this.drop=function(t){return f.cmanager.drop(t)},this.get=function(t){return f.cmanager.get(t)},this.find=function(t){return this.q(t)},this.waitFor=function(e,r){try{assert(e,"string"),assert(r,"function")}catch(t){return f.error(t.message,"Main::waitFor")}var i="wait-for-"+Math.floor(Math.random()*Math.floor(5e3)),a=0;f.thread.start(function(){var t=f.q(e);t.length&&(r(t),a=500),500<=a&&f.thread.stop(i),a++},i,.2)},this.debug=function(){this.debug_css||($("head").append("\t\t\t\t<style>\t\t\t\t\t.gratify-debug {\t\t\t\t\t\tborder: 2px solid red;\t\t\t\t\t}\t\t\t\t</style>\t\t\t"),this.debug_css=!0);var t=$("[gratify-plugin]");this.debug_active?t.removeClass("gratify-debug"):t.addClass("gratify-debug"),this.debug_active=!this.debug_active}}function GratifyDictionary(){var f=this;this.definitions={},this.lookup=function(t){var e;try{assert(t,"string"),e=f.explode(t)}catch(t){return gratify.error(t.message,"Dictionary::lookup")}var r,i=null;for(r in e){var a=e[r];if(null===i){if(void 0===f.definitions[a])return"";i=JSON.parse(JSON.stringify(f.definitions[a]))}else i=i[a];if("object"!=typeof i)break;if(void 0===i)return""}return i},this.define=function(t,e){var r;try{assert(t,"string"),assert(e,["string","object","number"]),r=f.explode(t)}catch(t){return gratify.error(t.message,"Dictionary::define")}var i,a=f.definitions,n=!0;for(i in r){var o=r[i];if(i==r.length-1){if(Array.isArray(e)&&(e=Object.assign({},e)),JSON.stringify(a[o])===JSON.stringify(e)){n=!1;break}a[o]=e;break}a=("object"!=typeof a[o]&&(a[o]={}),a[o])}if(n){gratify.say("definition of "+t+" updated");for(var s=r.length-1;0<=s;s--){for(var c in gratify.cmanager.components){c=gratify.cmanager.components[c];-1!==$.inArray(t,c.$udefs)&&gratify.cmanager.queue(c.$id,t,gratify.def(t))}t=t.replace(new RegExp("\\."+r[s]+"$"),"")}}},this.explode=function(t){if((t=String(t)).match(/^[a-z\d_\-\.]+$/i)&&-1===t.indexOf(".."))return t.split(".");throw new TypeError("invalid definition name; only letters, numbers, dashes, and underscores are allowed")}}function GratifyCManager(){var c=this;this.components={},this.updateQueue=[],this.spawn=function(t,e,r){var i,a;try{assert(t,"object"),assert(t.$id,"string"),i="string"==typeof(e="object"==typeof e?e:{}).id?e.id:t.$id,"string"==typeof t.$htdoc&&t.$htdoc,"object"==typeof t.$htargs&&t.$htargs,a="string"==typeof t.$target?t.$target:null,"object"==typeof e.parent&&e.parent,assert(e.target,["undefined","object","string"]),e.target,r=Boolean(r)}catch(t){return gratify.error(t.message,"CManager::spawn")}if(void 0!==c.components[i]){for(var n,o=i.match(/-\d+$/)?parseInt(i.match(/\d+$/)[0]):0;o++,n=i.replace(/-\d+$/,"")+"-"+o,void 0!==c.components[n];);i=n}try{gratify.say("spawning new component <"+i+">");var s=new GratifyComponent(t);s.$id=i,s.$options=e,c.components[i]=s,r||s.$create(e)}catch(t){return gratify.error(t.message,"CManager::spawn")}return gratify.say("new component ready <"+i+">"),c.components[i]},this.drop=function(t){return"object"==typeof t&&"string"==typeof t.$id&&(t=t.$id),"object"==typeof c.components[t]&&(c.components[t].$destroy(),delete c.components[t],gratify.say("dropped component <"+t+">"),!0)},this.get=function(t){return c.components[t]},this.queue=function(t,e,r){-1===$.inArray(t,c.updateQueue)&&(c.updateQueue.push({id:t,definition:e,content:r}),gratify.say("component "+t+" queued for update ("+e+")"))},gratify.thread.start(function(){for(var t in c.updateQueue){var e=c.updateQueue[t].id,r=c.updateQueue[t].definition,i=c.updateQueue[t].content,e=gratify.get(e);e&&(e.$update(r,i),gratify.say("component "+e.$id+" updated")),delete c.updateQueue[t]}},"cmanager.queue",.2)}function GratifyComponent(t){for(var e in assert(t,"object"),t){var r=t[e];switch(e){case"$create":case"$destroy":case"$draw":case"$update":assert(r,"function");break;case"$spawn":case"$ready":case"$rendered":case"$options":case"$reload":throw"user cannot define "+e}this[e]=r}this.hasOwnProperty("$create")||(this.$create=function(){}),this.hasOwnProperty("$destroy")||(this.$destroy=function(){}),this.$spawn=function(t,e){return assert(t,"object"),e="object"==typeof e?e:{},gratify.spawn(t,Object.assign(e,{parent:this}))},this.$ready=function(t){assert(t,"function"),gratify.waitFor("#"+this.$id,t)},this.$rendered=function(){return Boolean($("#"+this.$id).length)},this.$reload=function(){gratify.plugin(this.$container.parent(),this.$pluginstr,this.$options,"reload")}}function GratifyApp(){var t,i=this;this.params={},this.host=document.location.host,this.path=document.location.pathname,this.query=document.location.search,this.protocol=this.proto=document.location.protocol,this.base="",this.zoomlvl=100,this.cursor_x=0,this.cursor_y=0,this.breakpoint="tiny",this.do_breakpoints=!1,this.base_strip_public=!0,this.version_tag="",this.site_name="",this.root=document.body,this.browser="unknown",this.device="unknown",this.platform="unknown",this.platver="unknown",this.setVersionTag=function(t){if(!(t=String(t)).match(/^[a-z\d]+$/i))return gratify.error("invalid tag value","App::setVersionTag");i.version_tag=t},this.setSiteName=function(t){i.site_name=String(t)},this.include=function(t,e,r,i){try{i="object"==typeof i?i:{},assert(t,"string"),assert(e,"string")}catch(t){return gratify.error(t.message,"App::include")}var a;switch(t){case"script":(a=document.createElement("script")).async=!0,i.crossorigin&&(a.crossorigin=String(i.crossorigin)),"string"==typeof r&&(a.id=r),a.src=e.appendVersionTag();break;case"css":(a=document.createElement("link")).type="text/css",a.rel="stylesheet","string"==typeof r&&(a.id=r),a.href=e.appendVersionTag();break;default:return gratify.error("bad resource type","App::include")}$(document).find("head").append(a)},this.exclude=function(t){$("script#"+t+", link#"+t).remove()},this.sense=function(t){if(t||document.location.search!=i.query){t=location.search.split("?");if(1<t.length)for(var e in params=t[1].split("&"))(paramParts=params[e].split("="))[1]&&(i.params[paramParts[0]]=decodeURIComponent(paramParts[1].replace(/\+/g,"%20")))}try{$(window).trigger("resize"),i.zoomlvl=Math.round(100*window.devicePixelRatio)}catch(t){i.zoomlvl=100}},this.gotoBase=function(t){var e=this.base||"/";gratify.goto(e,!1,t)},i.do_breakpoints&&$(i.root).addClass("tiny"),(t=$("html > head")).length&&(t=t.find("base")).length&&(i.base=t.attr("href").replace(/\/+$/,""),i.base_strip_public)&&(i.base=i.base.replace(/\/public$/,"")),$(document).on("mousemove",function(t){i.cursor_x=t.pageX,i.cursor_y=t.pageY}),i.do_breakpoints&&$(window).on("resize",function(t){try{var e=parseInt(window.innerWidth),r=400<=(e=isNaN(e)||e<0?0:e)?"small":"tiny";1024<=e&&($(i.root).addClass("standard"),r="standard"),1920<=e&&(r="large",$(i.root).addClass("large")),r!=i.breakpoint&&($(i.root).removeClass("standard"),$(i.root).removeClass("large"),$(i.root).removeClass("small"),"small"==r?$(i.root).addClass("small"):"standard"==r?($(i.root).addClass("small"),$(i.root).addClass("standard")):"large"==r&&($(i.root).addClass("small"),$(i.root).addClass("standard"),$(i.root).addClass("large"))),i.breakpoint=r}catch(t){i.breakpoint="tiny"}}).trigger("resize"),(t=navigator.userAgent).match(/^Mozilla\/.+Edge\/.+$/)?i.browser="edge":t.match(/^Mozilla\/.+(Chrome\/|CriOS\/).+$/)?i.browser="chrome":t.match(/^Mozilla\/.+Trident\/.+$/)?i.browser="ie":t.match(/^Mozilla\/.+Gecko\/.+Firefox\/.+$/)?i.browser="firefox":t.match(/^Mozilla\/.+AppleWebKit\/.+Safari\/.+$/)&&(i.browser="safari"),t.match(/Windows NT/)?i.platform="win":t.match(/Android/)?i.platform="android":t.match(/(iOS|iPhone|iPad)/)?i.platform="ios":t.match(/Mac OS/)?i.platform="mac":t.match(/Linux/)&&(i.platform="linux"),"win"==i.platform&&(matches=t.match(/Windows NT ([\d\.]+)/))&&(i.platver=matches[1]),t.match(/Tablet|iPad/)&&"win"!=i.platform||"android"==i.platform&&!t.match(/Mobile/)?i.device="tablet":t.match(/Mobile|iPhone/)?i.device="phone":"win"!=i.platform&&"mac"!=i.platform||(i.device="desktop"),i.sense(!0)}function GratifyAuth(){var a=this;this.active=Boolean(GRATIFY_AUTH_ACTIVE)||!1,this.token="",this.user_info={},this.authorize=function(t,e){try{assert(t,["object"]),assert(e,["undefined","function"])}catch(t){return gratify.error(t.message,"Main::authorize")}t.grant_type;var r=t.token||"",i=(t.scope=t.scope||"id",t.no_redirect=!0,void 0===r);if(i){if(!a.active)return gratify.error("client was never authorized; must call authorize() with arguments on first time","Main::authorize");r=a.token,"cookie"!=gratify.config.auth_proto&&a.registerEpSession(!0)}if(!r)return gratify.error("token cannot be empty","Main::authorize");gratify.request("post "+gratify.auth_endpoint+"/get-token",t,function(t){if(t.errno)return i&&(a.active=!1,a.token=""),gratify.error(t.error,"Main::authorize");a.token=t.payload.access_token,a.active=!0,a.user_info=JSON.parse(atob(t.payload.id_token)),a.say("authorization success: "+a.token)},e)},this.registerId=function(t){var e="get "+gratify.auth_endpoint+"/my-id";Boolean(t)&&(e+=" --block"),gratify.web.request(e,{},function(t){return t.errno?gratify.error("could not register session id: "+t.error,"Main::registerId"):"string"!=typeof t.payload.id?gratify.error("could not register session id: bad id returned","Main::registerId"):(a.token=t.payload.id,sessionStorage.gratify_token=a.token,void gratify.say("session id registered: "+a.token))})},"cookie"!=gratify.config.auth_proto&&("string"==typeof sessionStorage.gratify_token&&(a.token=sessionStorage.gratify_token),a.registerId(!0))}function GratifyDatasource(){var f=this;this.subscribers={},this.threads={},this.subscribe=function(t){try{assert(t,["object"]),assert(t.id,["string"]),assert(t.bind,["string"]),assert(t.interval,["undefined","string"]),assert(t.url,["string"]),assert(t.component_id,["string","undefined"])}catch(t){return gratify.error(t.message,"Datasource::subscribe")}function e(){gratify.request("get "+n,{},function(t){if(t.errno)return gratify.error("datasource subscriber response error: "+t.error);f.loadDss(r,t.payload)})}var r=t.id,i=t.bind,a=t.interval||"",n=t.url,o=t.component_id||"";o||(gratify.say("warning: headless datasource subscriber: "+JSON.stringify(t)),o="GLOBAL");if(a){t=a.match(/^([0-9]+)([sm])$/);if(!t)return gratify.error("invalid interval value","Datasource::subscribe");a=Number(t[1]),t=("m"==t[2]&&(a*=60),!1);"object"!=typeof f.subscribers[r]&&(t=!0,f.subscribers[r]={thread_id:0,components:[]}),this.subscribers[r].components.push({id:o,bind:i}),t&&(o=gratify.thread.start(e,null,a),f.subscribers[r].thread_id=o)}else e()},this.unsubscribe=function(t){if(!t)return gratify.error("invalid subscription id","Datasource::unsubscribe");for(var e in gratify.say("unsubscribing '"+t+"'"),f.subscribers){var r,i=f.subscribers[e],a=i.components,n=i.thread_id,o=!1,s=(e===t&&(o=!0),a.length);for(r in a){var c=a[r].id;(o||c===t)&&((o||s<=1)&&gratify.thread.stop(n),delete f.subscribers[e].components[r])}f.subscribers[e].components=f.subscribers[e].components.filter(Boolean),s=f.subscribers[e].components.length,(o||s<=0)&&delete f.subscribers[e]}},this.loadDss=function(t,e){for(var r in this.subscribers)if(t===r){var i,a=this.subscribers[r].components;for(i in a){var n=a[i].bind;gratify.def(n,e)}}}}function GratifyWeb(){var d=this;this.max_tries=5,this.wait=1,this.seeds={},this.setWait=function(t){try{assert(t,"number")}catch(t){gratify.error(t.message,"Web::setWait")}d.wait=t},this.request=function(t,e,i,r){try{e=void 0===e?{}:e,i=void 0===i?function(){}:i,r=void 0===r?function(){}:r,assert(t,"string"),assert(e,"object"),assert(i,"function"),assert(r,"function")}catch(t){return gratify.error(t.message,"Web::request")}var a,n,o,s,c,f,u=t.match(/^(get|post|put|delete|file) (\S*)(( --?[a-z-]+)*)$/i);return u?(a=u[1].toLowerCase(),n=u[2],u=u[3].trim().split(" "),"get"===a&&e&&Object.keys(e).length&&(-1===n.indexOf("?")&&(n+="?"),n+=$.param(e)),o=Boolean(-1!==u.indexOf("--cache")),s=Boolean(-1!==u.indexOf("--version")||-1!==u.indexOf("-v")),u=Boolean(-1===u.indexOf("--block")),c=d.genseed(),gratify.say("starting "+a.toUpperCase()+" request #"+c+" to "+n),f=null,"file"==a?f=e:"post"==a&&(-1!==e.toString().indexOf("FormData")?(f={},e.forEach(function(t,e){f[e]=t})):f=e),e={},"header"==gratify.config.auth_proto&&(gratify.auth.token?e.Authorization="Bearer "+btoa(auth.token):n.match(/session/)?e.Authorization="Ask":e.Authorization="Guest"),gratify.config.origin_delegate&&(e["Origin-Delegate"]=gratify.config.origin_delegate),$.ajax({url:s?n.appendVersionTag():n,data:f,method:"get"==a?"get":"post",async:u,cache:o,headers:e,contentType:"file"!=a&&"application/x-www-form-urlencoded; charset=UTF-8",processData:"file"!=a,dataType:"text",xhrFields:{withCredentials:!0},success:function(t,e,r){gratify.say("#"+c+" responded "+r.status+" "+r.statusText);try{t=JSON.parse(t)}catch(t){gratify.say("warning: failed to parse response as json")}finally{i(t,c)}delete d.seeds[c]},error:function(t,e){return delete d.seeds[c],gratify.error("http request error [status:"+t.status+"; response:"+t.responseText+"]","Web::request")},complete:r}),c):gratify.error("bad request string: "+t,"Web::request")},this.genseed=function(){var t=0;for(i=0;i<100&&(t=Math.randint(1e5,999999),Boolean(d.seeds[t]));i++);return d.seeds[t]=Math.floor(Date.now()/1e3),t}}function GratifyThread(){var i=this;this.intervals={},this.start=function(t,e,r){try{assert(t,"function")}catch(t){return gratify.error(t.message,"Thread::start")}if("string"!=typeof e&&(e=(new Date).getTime()),Boolean(r)){if(!(r=String(r)).match(/^([0-9]+)?\.?([0-9]+)$/))return gratify.error("bad frequency value '"+r+"'","Thread::start");r=Number(r)}else gratify.say("warning: found non-numeric thread frequency; setting to 1"),r=1;return void 0===i.intervals[e]&&(i.intervals[e]={id:setInterval(t,1e3*r),frequency:r},t()),e},this.stop=function(t){void 0!==i.intervals[t]&&(gratify.say("stopping thread '"+t+"'"),clearInterval(i.intervals[t].id),delete i.intervals[t])}}function GratifyScanner(){var m=this;this.absorb_rate=.2,this.tick_rate=.25,this.reauth_wait=.25,this.reauth_count=0,this.reauth_max=3,this.max_elements_size=1024,this.elements=[],this.index_registry={},this.tags=["gratify-var","gratify-def","gratify-goto","gratify-plugin"],gratify.thread.start(function(){for(var t in m.tags){var a=m.tags[t];$(gratify.app.root).find("["+a+"]").each(function(t,e){for(var r in m.elements)if(e===m.elements[r].element)return;var i=m.elements.push({element:e})-1;gratify.say("scanner: new "+a+" @ "+e.tagName+"-"+i),i>m.max_elements_size&&(gratify.say("scanner: elements size exceeded "+m.max_elements_size+".. garbage collecting empty indexes"),m.elements=m.elements.filter(t=>t),gratify.say("scanner: post-gc size = "+m.elements.length))})}},"gratify-scanner-absorb-dom",this.absorb_rate),gratify.thread.start(function(){for(var t in m.elements){var e=gratify.app.root;if((e="ie"==gratify.app.browser&&e==document?document.body:e).contains(m.elements[t].element)){var e=$(m.elements[t].element),r=e.attr("gratify-var")||e.attr("gratify-def");r&&(i=gratify.def(r),e.html()!=i)&&(gratify.say("poulating def "+r),e.html(i));!e.attr("gratify-goto")||e.prop("gratify-goto-active")||e.prop("gratify-goto-active",!0).on("click",function(){gratify.goto($(this).attr("gratify-goto"))});r=e.attr("gratify-plugin");if(r&&(gratify.debug_active&&!e.hasClass("gratify-debug")&&e.addClass("gratify-debug"),!e.prop("gratify-plugin-loaded"))){var i=(r=(r=(r=r.replace(/[\r\n]+/g," ")).replace(/^\s+/,"")).replace(/\s+$/,"")).match(/^([a-z\d-]+)\.([a-z\d-]+)(\((.*)\))?$/i);if(!i)return e.prop("gratify-plugin-loaded",!0),gratify.error("invalid gratify plugin: "+r);if("true"!==String(e.attr("gratify-wait-for-auth"))||gratify.auth.active){gratify.say("scanner: loading plugin @ "+e.prop("tagName")+"-"+t);var r=i[1],a=i[2],h=i[4];if(h)try{h=h.replace(/'+/g,'"'),h=JSON.parse(h)}catch(t){gratify.error("could not parse plugin parameters: "+t.message+h)}(h="object"!=typeof h?{}:h).namespace=r,h.plugin=a,h.json=1,r=gratify.request("get "+gratify.system_endpoint+"/plugin --cache --version",h,function(t,e){var r=m.index_registry[e],i=$(m.elements[r].element);if(3==t.errno){if(gratify.auth.active&&m.reauth_count<m.reauth_max)return m.reauth_count++,gratify.say("session expired.. re-authorizing"),gratify.auth.authorize(),void setTimeout(function(){i.prop("gratify-plugin-loaded",!1)},m.reauth_wait)}else m.reauth_count=0;if(0==i.length)return gratify.error("destination element has gone away (seed#"+e+")");if(delete m.index_registry[e],"object"!=typeof t)return gratify.error("invalid response from plugin endpoint: "+String(t));if(t.errno)return gratify.error(t.error);if(!t.payload)return gratify.error("empty or invalid payload received: "+String(t.payload));try{var a=document.head||null,n=(a||gratify.say("warning: no document head; plugin js/css will be skipped"),t.payload.meta),o=t.payload.html,s=t.payload.css,c=t.payload.js;if(!n)throw{message:"no meta data received",code:1};var f=n.namespace,u=n.component_name,d=f+"-"+n.plugin_name,g=f+"."+n.plugin_name,l=n.subscribers;if(o&&i.html(o),a&&(s&&$(document).find("head").append("<style>"+s+"</style>"),c)){"object"!=typeof gratify.components[f]&&(gratify.components[f]={}),"object"!=typeof gratify.components[f][u]&&$(a).append("<script>"+c+"<\/script>");var p=gratify.components[f][u];if("object"!=typeof p)throw{message:"component js missing object definition '"+f+"."+u+"'"};p.$id=u,p.$pluginstr=g;var y=gratify.spawn(p,{},!0);for(e in y&&(y.$container=i.find("."+d)),y.$create(h),m.elements[r].plugin_ref=y.$id,l){n=l[e];gratify.datasource.subscribe({id:e,url:n.url,interval:n.interval||"",bind:n.bind,component_id:y.$id})}}}catch(t){gratify.error("error loading plugin: "+t.message,t)}}),m.index_registry[r]=t,e.prop("gratify-plugin-loaded",!0)}}}else gratify.say("scanner: garbage collecting "+m.elements[t].element.tagName+"-"+t),m.elements[t].plugin_ref&&gratify.drop(m.elements[t].plugin_ref),gratify.datasource.unsubscribe(m.elements[t].plugin_ref),delete m.elements[t]}},"gratify-scanner-event-handler",this.tick_rate)}function GratifyRouter(){var r=this;this.started=!1,this.myRoute="",this.routes={},this.strict=!1,this.start=function(t,e){if(e="object"==typeof e?e:{},strict=Boolean(e.strict),auto=Boolean(e.auto),r.started)return!1;try{assert(t,"object")}catch(t){return gratify.error(t.message,"Router::start")}return r.routes=t,window.addEventListener("popstate",function(t){t=t.target.location;r.goto(t.pathname+(t.hash||""),!1)}),strict&&(r.strict=!0),r.started=!0,gratify.say("router started with "+Object.keys(t).length+" nodes"),auto&&r.resolve(e),!0},this.resolve=function(t){var e=location.pathname+(location.search||"")+(location.hash||"");gratify.say("resolving "+e),r.goto(e,!1)},this.back=function(){r.goto(r.lastRoute)},this.goto=function(t,e,r){var i=this;try{e=void 0!==e&&e,r=Boolean(r),assert(t,"string")}catch(t){return gratify.error(t.message,"Router::goto")}var a=gratify.app.base||"";if(t=t.replace(a,"").replace(/\/+$/,"")||"/",!r){-1!==t.indexOf("#")&&(t=t.split("#")[0]),gratify.say("routing to "+t);var n,r="",o="",s=null,c=null,f={},u=[],d=[],g="",l="";for(n in o=t.split("?")[0],i.routes)if(n.match(/\*$/)){if(1<n.split("*").length-1)return gratify.error("too many route wildcards; only 1 allowed");var p=o.match(new RegExp("^"+n.replace("*","(.*)"),"i"));if(p&&p.length){var y,o=i.routes[n],h=p[1].split("/");for(y in h)h[y]&&(f[y]=h[y])}}else o.toLowerCase()==n.toLowerCase()&&(o=i.routes[n]);if(s=1<(d=(u=o.split("?"))[0].split("/")).length?d[1].toLowerCase():i.strict?null:"main",c=2<d.length?d[2].toLowerCase():i.strict?null:"index"){var m,b="",v=c.split("-");for(m in v)g=v[m],b+=0<m?g.charAt(0).toUpperCase()+g.slice(1):g.charAt(0)+g.slice(1);l&&(l+="-"),l+=c=b}if(1<u.length)for(var _=u[1].split("&"),w=0;w<_.length;w++){var $=_[w].split("=")[0],k=_[w].split("=")[1]||!0;f[$]="0"===k?0:k}"string"==typeof f.page_title&&(d=f.page_title.trim(),gratify.app.site_name&&(d=d+" | "+gratify.app.site_name.trim()),document.title=d);var j,S="",x=s.split("-");for(j in x)S+=(g=x[j]).charAt(0).toUpperCase()+g.slice(1);u=gratify.get(S);if(!u)return d="component "+S+" does not exist","Default"==S&&(d+="; please check your routes"),gratify.error(d,"Router::goto");if("function"!=typeof u[c])return gratify.error('action "'+c+'" does not exist for '+S,"Router::goto");t!=i.myRoute&&(e?window.history.pushState(f,l,a+t):window.history.replaceState(f,l,a+t),i.lastRoute=i.myRoute,i.myRoute=t);try{r=u[c](f)}catch(t){r=!1,gratify.error("exception: "+t.message,"Router::goto")}return gratify.app.sense(),r}gratify.say("relocating to "+t),document.location.href=t}}"function"!=typeof Object.assign&&(Object.assign=function(t,e){"object"!=typeof t&&(t={}),"object"!=typeof e&&(e=[]);var r,i=JSON.parse(JSON.stringify(t));for(r in e)i[r]=e[r];return i}),"function"!=typeof Math.randint&&(Math.randint=function(t,e){return t=Math.ceil(t),e=Math.floor(e),Math.floor(Math.random()*(e-t))+t}),String.prototype.padStart||(String.prototype.padStart=function(t,e){return t>>=0,e=String(void 0!==e?e:" "),this.length>=t?String(this):((t-=this.length)>e.length&&(e+=e.repeat(t/e.length)),e.slice(0,t)+String(this))}),Array.prototype.includes||Object.defineProperty(Array.prototype,"includes",{value:function(t,e){return Boolean(-1<Array(this).indexOf(t,e))}}),String.prototype.rot13||(String.prototype.rot13=function(){return String(this).replace(/[a-zA-Z]/g,function(t){return String.fromCharCode((t<="Z"?90:122)>=(t=t.charCodeAt(0)+13)?t:t-26)})}),String.prototype.appendVersionTag||(String.prototype.appendVersionTag=function(){var t=String(this);return""!=gratify.app.version_tag&&(-1===t.indexOf("?")?t+="?":t+="&",t+="_="+encodeURIComponent(gratify.app.version_tag)),t}),String.prototype.isValidUrl||(String.prototype.isValidUrl=function(t){t=t||"https",t+=":";try{url=new URL(String(this))}catch(t){return!1}return url.protocol==t}),Number.prototype.byteshr||(Number.prototype.byteshr=function(){for(var t=this.valueOf(),e=[" Bytes"," KB"," MB"," GB"],r=1;r<e.length;r++)if(t<Math.pow(1024,r))return Math.round(t/Math.pow(1024,r-1)*100)/100+e[r-1];return t}),jQuery.fn.extend({selectMe:function(){var t=$(this)[0],e=document.createRange(),t=(e.setStartBefore(t.firstChild),e.setEndAfter(t.lastChild),window.getSelection());t.removeAllRanges(),t.addRange(e)}});var gratify,_gfy_init,min_jq_ver=3.1,config={loud:!0,auth_proto:"cookie"};"undefined"==typeof jQuery?console.error("could not load gratify; missing jQuery"):parseFloat(jQuery().jquery.substr(0,3))<min_jq_ver?console.error("could not load gratify; jQuery version too old -- requires at least "+min_jq_ver+".x"):($!==jQuery&&($=jQuery),_gfy_init=function(){(gratify=new GratifyMain).version=__gfy_version__,gratify.init(config)},"loading"!==document.readyState?_gfy_init():window.addEventListener("DOMContentLoaded",_gfy_init));